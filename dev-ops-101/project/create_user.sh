#!/bin/bash

# Запрашиваем имя нового пользователя
read -p "Введите имя нового пользователя: " username

# Проверяем, существует ли уже пользователь
if id "$username" &>/dev/null; then
    echo "Ошибка: Пользователь '$username' уже существует!"
    exit 1
fi

# Запрашиваем, нужно ли создавать новую группу или использовать существующую
echo "Выберите опцию для группы пользователя:"
echo "1. Создать новую группу"
echo "2. Добавить пользователя в существующую группу"
read -p "Введите номер опции (1 или 2): " group_choice

# Если выбрана опция 1 (создание новой группы)
if [ "$group_choice" -eq 1 ]; then
    # Запрашиваем имя новой группы
    read -p "Введите имя новой группы: " groupname

    # Проверяем, существует ли уже такая группа
    if getent group "$groupname" &>/dev/null; then
        echo "Ошибка: Группа '$groupname' уже существует!"
        exit 1
    fi

    # Создаем новую группу
    echo "Создаем группу '$groupname'..."
    sudo groupadd "$groupname"
    
    # Создаем пользователя и добавляем в новую группу
    echo "Создаем пользователя '$username' с группой '$groupname'..."
    sudo useradd -m -g "$groupname" "$username"
    
elif [ "$group_choice" -eq 2 ]; then
    # Запрашиваем имя существующей группы
    read -p "Введите имя существующей группы: " groupname

    # Проверяем, существует ли такая группа
    if ! getent group "$groupname" &>/dev/null; then
        echo "Ошибка: Группа '$groupname' не существует!"
        exit 1
    fi

    # Создаем пользователя и добавляем в существующую группу
    echo "Создаем пользователя '$username' и добавляем в группу '$groupname'..."
    sudo useradd -m -g "$groupname" "$username"
else
    echo "Ошибка: Неверный выбор. Завершаем скрипт."
    exit 1
fi

# Устанавливаем пароль для нового пользователя
echo "Установите пароль для пользователя '$username':"
sudo passwd "$username"

# Печатаем успешное сообщение
echo "Пользователь '$username' успешно создан и добавлен в группу '$groupname'."

